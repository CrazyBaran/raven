<div class="grid h-full grid-cols-[1fr_1fr] gap-3">
  <kendo-tilelayout
    [columns]="12"
    [draggable]="false"
    [gap]="12"
    class="h-full !p-0"
  >
    <ng-container [formGroup]="formGroup">
      <kendo-tilelayout-item
        *rxFor="let field of vm().fields; strategy: 'immediate'"
        [title]="field.title"
        [col]="1"
        [colSpan]="12"
      >
        <kendo-tilelayout-item-body>
          <app-rich-text
            class="h-full"
            [grow]="true"
            placeholder="Click to write content here..."
            [formControlName]="field.id"
            [borderless]="true"
          >
          </app-rich-text>
          <!--          <div-->
          <!--            class="bg-grey-100 flex h-full flex-col gap-3 bg-opacity-50 px-6 py-5"-->
          <!--          >-->

          <!--            <div [innerHTML]="field.value | safeHtml"></div>-->
          <!--          </div>-->
        </kendo-tilelayout-item-body>
      </kendo-tilelayout-item>
    </ng-container>
  </kendo-tilelayout>

  <kendo-tilelayout
    [columns]="12"
    [draggable]="false"
    [gap]="12"
    rowHeight="100%"
    class="h-full !p-0"
  >
    <kendo-tilelayout-item title="Related Notes" [colSpan]="12">
      <kendo-tilelayout-item-body>
        <div
          *rxIf="vm().notesLoading; else relatedNote"
          class="flex h-full items-center"
        >
          <ui-loader></ui-loader>
        </div>
        <!--      NOTE    -->
      </kendo-tilelayout-item-body>
    </kendo-tilelayout-item>
  </kendo-tilelayout>
</div>

<ng-template #relatedNote>
  <div class="flex h-full flex-col">
    <header>
      <div class="flex flex-col">
        <div class="flex">
          <!--        NOTE TYPE        -->
          <div class="px-3 py-4">
            <div
              [ngClass]="{
                'bg-series-a-lighten-50':
                  vm().relatedNote.templateName === 'Company call',
                'bg-series-e-lighten-50':
                  vm().relatedNote.templateName === 'Notes & Analysis',
                'bg-series-g-lighten-50':
                  vm().relatedNote.templateName === 'Market Research'
              }"
              class="bg-series-a-lighten-50 w-fit rounded p-1.5"
            >
              {{ vm().relatedNote.templateName }}
            </div>
          </div>

          <!--        CREATE INFO       -->
          <div class="grow px-3 py-2">
            <div class="flex flex-col gap-1">
              <span>
                <i class="fa-solid fa-circle-user mr-1"></i>
                {{ vm().relatedNote?.createdBy?.name || '' }}
              </span>

              <span class="text-xs">
                Updated:
                {{
                  vm().relatedNote?.updatedAt || '' | date: 'dd/MM/yyyy hh:mm a'
                }}
              </span>
            </div>
          </div>

          <!--        ACTION ICON       -->
          <div class="p-3">
            <kendo-button
              [routerLink]="['./']"
              [queryParams]="{ noteId: vm().relatedNote.id }"
              queryParamsHandling="merge"
              themeColor="primary"
              iconClass="fa-solid fa-eye"
            >
            </kendo-button>
          </div>
        </div>
        <div class="px-3 pb-6 pt-3">
          <p class="font-bold">{{ vm().relatedNote?.name }}</p>
        </div>
      </div>
    </header>
    <article
      class="border-component-border grow basis-0 overflow-auto border-b border-t"
    >
      <div class="h-full">
        <div
          *rxIf="vm().notesDetailLoading; else relatedNoteContent"
          class="flex h-full items-center"
        >
          <ui-loader></ui-loader>
        </div>
      </div>
    </article>
    <footer>
      <div class="flex items-center justify-between gap-2 p-3">
        <kendo-button
          themeColor="primary"
          class="min-w-[80px]"
          [disabled]="vm().disabledPrev"
          [queryParams]="vm().prevQueryParam"
          [routerLink]="[]"
          queryParamsHandling="merge"
        >
          Previous
        </kendo-button>

        <div class="text-lg">
          {{ vm().index + 1 + ' of ' + vm().relatedNotes.length }}
        </div>

        <kendo-button
          themeColor="primary"
          class="min-w-[80px]"
          [disabled]="vm().disabledNext"
          [queryParams]="vm().nextQueryParam"
          [routerLink]="[]"
          queryParamsHandling="merge"
        >
          Next
        </kendo-button>
      </div>
    </footer>
  </div>
</ng-template>

<ng-template #relatedNoteContent>
  <div class="flex flex-col gap-3" *rxFor="let note of vm().relatedNoteFields">
    <div class="p-3">
      <div class="mb-2 text-[10px] uppercase">
        {{ note.name }}
      </div>
      <div class="ProseMirror" [innerHTML]="note.value | safeHtml"></div>
    </div>
  </div>
</ng-template>
