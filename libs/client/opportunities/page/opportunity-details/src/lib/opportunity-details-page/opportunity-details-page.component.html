<app-page-template>
  <div class="flex items-center gap-2" page-header-title>
    <kendo-button
      [routerLink]="['/companies']"
      fillMode="flat"
      iconClass="fa-sharp fa-regular fa-cart-shopping"
      themeColor="primary"
      >All Companies</kendo-button
    >
    <ng-container *ngIf="vm().currentOrganisation?.name">
      <i
        class="fa-sharp fa-solid fa-chevron-right text-grey-800 text-xs text-opacity-60"
      ></i>
      <kendo-button
        [routerLink]="['/companies', vm().currentOrganisation?.id]"
        fillMode="flat"
        themeColor="primary"
        >{{ vm().currentOrganisation?.name }}</kendo-button
      >
      <i
        class="fa-sharp fa-solid fa-chevron-right text-grey-800 text-xs text-opacity-60"
      ></i>
      <kendo-button
        fillMode="flat"
        iconClass="fa-sharp fa-regular fa-fire"
        themeColor="primary"
        [routerLink]="['/companies/pipeline']"
        >Pipeline</kendo-button
      >
      <i
        class="fa-sharp fa-solid fa-chevron-right text-grey-800 text-xs text-opacity-60"
      ></i>
      <kendo-button [disabled]="true" fillMode="flat" themeColor="primary"
        >Opportunity</kendo-button
      >
    </ng-container>
  </div>
  <div class="flex gap-1" page-header-actions>
    <kendo-dropdownlist
      class="!min-w-[200px]"
      [data]="vm().lines.data"
      [loading]="vm().lines.isLoading"
      [valuePrimitive]="true"
      [value]="vm().lines.value"
      [disabled]="vm().lines.disabled"
      (valueChange)="onStageChange($event)"
      fillMode="flat"
      textField="displayName"
      valueField="id"
    />
  </div>
  <div
    class="opportunity-details | bg-base-background flex h-full flex-col"
    page-content
  >
    <ng-container>
      <div class="grid h-[92px] grid-cols-4 gap-6 px-8 py-2">
        <ng-container
          *ngIf="
            vm().opportunityIsLoading || vm().organisationIsLoading;
            else details
          "
        >
          <div *rxFor="let i of 3 | times" class="px-2 py-3">
            <kendo-skeleton [height]="24" class="mb-2" width="50%" />
            <kendo-skeleton [height]="20" width="30%" />
          </div>
        </ng-container>
        <ng-template #details>
          <div
            *rxFor="let detail of vm().details; trackBy: 'label'"
            [@fadeIn]
            class="grow px-2 py-3"
          >
            <h1 class="mb-2 text-lg">{{ detail.label }}</h1>
            <p class="text-sm">{{ detail.subLabel }}</p>
          </div>
        </ng-template>
      </div>
      <div class="grid flex-1 grid-cols-[180px_1fr] overflow-hidden">
        <div class="h-100 flex flex-col bg-white">
          <kendo-buttongroup
            class="navigations !flex !flex-col"
            selection="single"
          >
            <kendo-button
              *rxFor="let navigation of vm()?.navigations; trackBy: 'label'"
              [ngStyle]="$any(navigation).style ?? {}"
              [queryParams]="navigation.queryParams"
              [routerLink]="navigation.link"
              [selected]="navigation.active"
              [toggleable]="true"
              class="!justify-start"
              fillMode="flat"
              size="large"
              themeColor="primary"
            >
              <div class="nav-clas-btn w-full truncate">
                {{ navigation.label }}
              </div>
            </kendo-button>
          </kendo-buttongroup>

          <!--          <div *ngIf="vm().notesIsLoading" class="!flex !flex-col gap-2">-->
          <!--            <kendo-skeleton-->
          <!--              class="bg-primary-25"-->
          <!--              *rxFor="let i of 5 | times"-->
          <!--              width="70%"-->
          <!--            ></kendo-skeleton>-->
          <!--          </div>-->
        </div>
        <div class="border-grey-300 overflow-hidden border p-3">
          <div class="h-full w-full">
            <router-outlet />
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</app-page-template>

<ng-template #loader>
  <ui-loader />
</ng-template>
