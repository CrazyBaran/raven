<kendo-grid
  #grid
  [data]="gridData"
  [expandedDetailKeys]="collapsedRows()"
  [loading]="isLoading"
  [pageSize]="take"
  [pageable]="pageable"
  [rowClass]="rowCallback"
  [skip]="skip"
  [sort]="sort"
  [sortable]="true"
  class="organisation-table h-full"
  kendoGridExpandDetailsBy="id"
  scrollable="scrollable"
  uiKendoUrlPaging
  uiKendoUrlSorting
>
  <kendo-grid-column [width]="85" headerClass="!font-bold" title="Shortlist">
    <ng-template kendoGridCellTemplate let-organisation>
      <div class="flex w-full justify-center">
        <i
          [ngClass]="{
            'fa-solid': organisation.shortList,
            'fa-regular': !organisation.shortList
          }"
          class="fa-star"
        ></i>
      </div>
    </ng-template>
  </kendo-grid-column>

  <kendo-grid-column
    [sortable]="true"
    field="name"
    headerClass="!font-bold"
    title="Company"
  >
    <ng-template kendoGridCellTemplate let-organisation>
      <div class="flex items-center gap-3">
        <i class="fa-regular fa-image text-xl"></i>
        <div
          [routerLink]="['/companies', organisation.id]"
          class="hover:text-primary-600 group flex grow cursor-pointer items-center gap-3 overflow-hidden transition-all duration-100"
        >
          <div class="grow overflow-hidden">
            <p [isEllipsisActive]="true" class="group-hover:font-bold">
              {{ organisation.name }}
            </p>

            @if (organisation.domains[0]) {
              <p [isEllipsisActive]="true" class="text-xs">
                {{ organisation.domains[0] }}
              </p>
            }
          </div>
        </div>
      </div>
    </ng-template>
  </kendo-grid-column>

  <kendo-grid-column headerClass="!font-bold" title="Status">
    <ng-template kendoGridCellTemplate let-organisation>
      <div class="flex items-center gap-3">
        <i
          [style.color]="organisation.status.color"
          class="fa-solid fa-circle text-xs"
        ></i>
        <p [isEllipsisActive]="true" class="flex-1 text-black">
          {{ organisation.status.name ?? '' }}
        </p>
      </div>
    </ng-template>
  </kendo-grid-column>

  <kendo-grid-column field="score" headerClass="!font-bold" title="MCV Score" />

  <kendo-grid-column
    field="specterRank"
    headerClass="!font-bold"
    title="Specter Rank"
  />

  <kendo-grid-column field="domain" headerClass="!font-bold" title="Domain" />

  <kendo-grid-column field="hq" headerClass="!font-bold" title="HQ" />

  <kendo-grid-column [width]="60" title="">
    <ng-template kendoGridCellTemplate let-organisation>
      @if (organisation.opportunities.length > 0) {
        <kendo-button
          (click)="toggleRow(organisation.id)"
          [iconClass]="
            'fa-solid fa-caret-' +
            (isRowCollapsed(organisation.id) ? 'up' : 'down')
          "
          fillMode="link"
        />
      }
    </ng-template>
  </kendo-grid-column>

  <ng-template kendoGridDetailTemplate let-organisation>
    <app-opportunities-table [rows]="organisation.opportunities" />
  </ng-template>
</kendo-grid>
