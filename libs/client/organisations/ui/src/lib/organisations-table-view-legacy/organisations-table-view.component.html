<kendo-grid
  [data]="gridData"
  [loading]="isLoading"
  [pageSize]="take"
  [pageable]="pageable"
  [skip]="skip"
  [sort]="sort"
  [sortable]="true"
  class="grid-borderless h-full"
  scrollable="scrollable"
  uiKendoUrlPaging
  uiKendoUrlSorting
>
  <kendo-grid-column
    [sortable]="true"
    class="!align-text-top"
    field="name"
    headerClass="!font-bold"
    title="Company"
  >
    <ng-template kendoGridCellTemplate let-dataItem>
      <div class="flex items-center gap-3">
        <i class="fa-regular fa-image text-xl"></i>
        <div
          [routerLink]="['/companies', dataItem.id]"
          class="hover:text-primary-600 group flex grow cursor-pointer items-center gap-3 overflow-hidden transition-all duration-100"
          data-testid="company-profile-link"
        >
          <div class="grow overflow-hidden">
            <p [isEllipsisActive]="true" class="group-hover:font-bold">
              {{ dataItem.name }}
            </p>

            @if (dataItem.domains[0]) {
              <p [isEllipsisActive]="true" class="text-xs">
                {{ dataItem.domains[0] }}
              </p>
            }
          </div>
          <i class="fa-solid fa-share"></i>
        </div>
      </div>
    </ng-template>
  </kendo-grid-column>

  <kendo-grid-column headerClass="!font-bold" title="Funding Round">
    <ng-template kendoGridCellTemplate let-dataItem>
      <div class="flex flex-col gap-4">
        <div
          *rxFor="
            let opportunity of dataItem | expandableList: collapsedRows();
            strategy: 'immediate'
          "
          class="flex h-10 items-center"
        >
          <p>{{ opportunity?.tag?.name || 'No Opportunity' }}</p>
        </div>
      </div>
    </ng-template>
  </kendo-grid-column>

  <kendo-grid-column headerClass="!font-bold" title="Pipeline Status">
    <ng-template kendoGridCellTemplate let-dataItem>
      <div class="flex flex-col gap-4">
        <div
          *rxFor="
            let opportunity of dataItem | expandableList: collapsedRows();
            strategy: 'immediate'
          "
          class="flex h-10 items-center gap-3"
        >
          <i
            [style.color]="opportunity.stageColor"
            class="fa-solid fa-circle text-xs"
          ></i>
          <p [isEllipsisActive]="true" class="flex-1 text-black">
            {{ opportunity.stage?.displayName ?? '' }}
          </p>
        </div>
      </div>
    </ng-template>
  </kendo-grid-column>

  <kendo-grid-column headerClass="!font-bold" title="Deal Lead">
    <ng-template kendoGridCellTemplate let-dataItem>
      <div class="flex flex-col gap-4">
        <div
          *rxFor="
            let opportunity of dataItem | expandableList: collapsedRows();
            strategy: 'immediate'
          "
          class="flex h-10 items-center gap-1"
        >
          <ui-tags-container
            [rows]="1"
            [tags]="opportunity.team | dealLeads | toUserTag"
            class="w-full"
          ></ui-tags-container>
        </div>
      </div>
    </ng-template>
  </kendo-grid-column>

  <kendo-grid-column headerClass="!font-bold" title="Deal Team">
    <ng-template kendoGridCellTemplate let-dataItem>
      <div class="flex flex-col gap-4">
        <div
          *rxFor="
            let opportunity of dataItem | expandableList: collapsedRows();
            strategy: 'immediate';
            trackBy: 'id'
          "
          class="flex h-10 items-center gap-1"
        >
          <ui-tags-container
            [rows]="1"
            [tags]="opportunity.team | dealTeam | toUserTag"
            class="w-full"
          ></ui-tags-container>
        </div>
      </div>
    </ng-template>
  </kendo-grid-column>

  <!--  TODO: Implement when company tags ready -->
  <!--  <kendo-grid-column headerClass="!font-bold" title="Tags">-->
  <!--    <ng-template kendoGridCellTemplate let-dataItem>-->
  <!--      <div class="flex flex-col gap-4">-->
  <!--        <div-->
  <!--          *rxFor="-->
  <!--            let opportunity of dataItem | expandableList: collapsedRows();-->
  <!--            strategy: 'immediate'-->
  <!--          "-->
  <!--          class="flex h-10 items-center gap-1"-->
  <!--        >-->
  <!--          <i class="fa-solid fa-circle-user mr-1"></i>-->
  <!--          <p class="flex-1 truncate text-black">-->
  <!--            {{ 'Shaun Lee' }}-->
  <!--          </p>-->
  <!--        </div>-->
  <!--      </div>-->
  <!--    </ng-template>-->
  <!--  </kendo-grid-column>-->

  <kendo-grid-column [width]="90" class="!align-text-top" title="">
    <ng-template kendoGridCellTemplate let-dataItem>
      <div class="flex flex-col gap-4">
        <div
          *rxFor="
            let opportunity of dataItem | expandableList: collapsedRows();
            strategy: 'immediate'
          "
          class="flex h-10 items-center gap-1"
        >
          <div class="flex gap-1">
            <kendo-button
              [routerLink]="[
                '/companies',
                dataItem.id,
                'opportunities',
                opportunity.id
              ]"
              iconClass="fa-solid fa-eye"
              themeColor="primary"
            ></kendo-button>
            <kendo-button
              [uiClipboard]="
                ['companies', dataItem.id, 'opportunities', opportunity.id]
                  | toUrl
              "
              iconClass="fa-solid fa-link"
            ></kendo-button>
          </div>
        </div>
      </div>
    </ng-template>
  </kendo-grid-column>
  <kendo-grid-column [width]="60" class="!align-text-top" title="">
    <ng-template kendoGridCellTemplate let-dataItem>
      <kendo-button
        (click)="toggleRow(dataItem.id)"
        *rxIf="dataItem.opportunities.length > 1"
        [iconClass]="
          'fa-solid fa-caret-' + (isRowCollapsed(dataItem.id) ? 'up' : 'down')
        "
        fillMode="link"
      ></kendo-button>
    </ng-template>
  </kendo-grid-column>
</kendo-grid>
