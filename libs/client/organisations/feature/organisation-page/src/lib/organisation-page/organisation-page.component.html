<app-page-template>
  <div class="flex items-center gap-2" page-header-title>
    <kendo-button
      [routerLink]="['/companies']"
      fillMode="flat"
      iconClass="fa-sharp fa-regular fa-cart-shopping"
      themeColor="primary"
    >
      All Companies
    </kendo-button>

    @if (vm().currentOrganisation?.name) {
      <i
        [@fadeIn]
        class="fa-sharp fa-solid fa-chevron-right text-grey-800 text-xs text-opacity-60"
      ></i>
      <kendo-button
        [@fadeIn]
        [disabled]="true"
        fillMode="flat"
        themeColor="primary"
      >
        {{ vm().currentOrganisation?.name }}
      </kendo-button>
    }
  </div>

  <div class="flex gap-2" page-header-actions>
    <kendo-button
      [ngClass]="{
        '!text-informational-warning':
          !!shortlistsTable?.organisationShortlistsStore?.data?.()?.total
      }"
      class="mr-2"
      kendoTooltip
      title="Add to Shortlist"
      themeColor="primary"
      iconClass="fa-solid fa-star"
      [queryParams]="vm().addToShortlistQueryParam"
      queryParamsHandling="merge"
      [skipLocationChange]="true"
      [routerLink]="['./']"
    />
    @if (vm().showStatus) {
      <div class="flex items-center gap-3">
        <i
          [style.color]="vm().status.color"
          class="fa-solid fa-circle text-xs"
        ></i>
        <p [isEllipsisActive]="true" class="flex-1 text-black">
          {{ vm().status.name | titlecase }}
        </p>
      </div>
    }

    @if (vm().showOutreachButton) {
      <kendo-button
        [queryParams]="vm().outreachQueryParam"
        queryParamsHandling="merge"
        [skipLocationChange]="true"
        [routerLink]="['./']"
        themeColor="primary"
      >
        Add To Outreach
      </kendo-button>
    }

    @if (vm().showPassButton) {
      <app-dropdownbutton-navigation [model]="dropdownButtonActions" />
    }
  </div>

  <div
    class="organisation-details | bg-base-background flex h-full flex-col overflow-y-scroll"
    page-content
  >
    <kendo-tabstrip
      *featureFlag="'organisationLayout'; else legacyLayout"
      class="organisation-layout-tabstrip"
    >
      <kendo-tabstrip-tab title="Public Profile" [selected]="true">
        <ng-template kendoTabContent>
          <div class="flex flex-col gap-6">
            <ng-container [ngTemplateOutlet]="header" />
          </div>

          <div class="grid grid-cols-2 gap-6">
            <app-organisation-news-table />
          </div>
        </ng-template>
      </kendo-tabstrip-tab>

      <kendo-tabstrip-tab title="Company Details">
        <ng-template kendoTabContent>
          <ng-container [ngTemplateOutlet]="header" />
          <div class="flex flex-col gap-6">
            <app-organisation-opportunities-v2 />

            <!--            TODO:           -->
            <!-- <app-organisation-company-timeline />-->

            <app-organisation-shortlists-table />

            <app-organisation-reminders-table />

            <app-organisation-files />

            <app-organisation-notes />
          </div>
        </ng-template>
      </kendo-tabstrip-tab>
    </kendo-tabstrip>
  </div>
</app-page-template>

<ng-template #header>
  <div class="mb-6 flex flex-col gap-6">
    <div class="grid grid-cols-2 gap-6">
      <app-organisation-details-v2 />
    </div>
  </div>
</ng-template>

<ng-template #legacyLayout>
  <div class="flex flex-col gap-6">
    <div class="grid grid-cols-2 gap-6">
      <app-organisation-details />
      <app-organisation-opportunities />
    </div>

    <app-organisation-shortlists-table />

    <app-organisation-reminders-table />

    <app-organisation-files />

    <app-organisation-notes />
  </div>
</ng-template>
