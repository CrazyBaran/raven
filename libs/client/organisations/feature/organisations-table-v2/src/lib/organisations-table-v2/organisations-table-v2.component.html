<app-page-template
  pageIcon="fa-regular fa-cart-shopping"
  pageName="All Companies"
>
  <div class="flex items-center gap-3" page-header-actions>
    @if (vm().lastChecked) {
      <p class="text-subtle-text text-xs">
        Last DW sync: {{ vm().lastChecked | date: 'dd/MM/yyyy hh:mm a' }}
      </p>
    }
    <app-text-box-navigation class="w-64" [model]="vm().queryModel" />
    <kendo-button
      fillMode="flat"
      size="large"
      iconClass="fa-solid fa-square-plus"
      (click)="showCreateDialog.set(true)"
      >Add new</kendo-button
    >
  </div>
  <div
    class="flex h-[calc(100%+1.5em)] w-[calc(100%+1.5em)] flex-col gap-6"
    page-content
  >
    <app-quick-filters-template>
      <div class="flex gap-6">
        <app-buttongroup-navigation [model]="vm().buttonGroupNavigation" />
        <app-buttongroup-navigation [model]="vm().statuses" />
      </div>
    </app-quick-filters-template>

    @if ((vm().filters | keyvalue).length > 0) {
      <app-filter-tiles [filters]="vm().filters" />
    }

    <div class="flex-1 shrink-0 overflow-hidden">
      <app-organisations-table
        [model]="vm().tableModel!"
        class="block h-full"
      />
    </div>
  </div>
</app-page-template>

@if (showCreateDialog()) {
  <kendo-dialog
    title="Add New Company to Raven"
    [width]="424"
    (close)="showCreateDialog.set(false)"
  >
    <div class="flex flex-col gap-4 p-10">
      <p>
        If you canâ€™t find a company in the list, add it by providing the details
        below. Please ensure the domain is correct so that automatic updates
        work correctly in the future.
      </p>
      <form [formGroup]="organisationFormGroup">
        <kendo-formfield>
          <kendo-label text="Company Name">
            <kendo-combobox
              [filterable]="true"
              formControlName="name"
              [data]="companies()"
              [valuePrimitive]="true"
              [allowCustom]="true"
              [loading]="loading()"
              (filterChange)="onFilterChange($event)"
            />
          </kendo-label>
        </kendo-formfield>
        <kendo-formfield>
          <kendo-label text="Company Domain">
            <kendo-textbox formControlName="domain" [clearButton]="true">
            </kendo-textbox>
          </kendo-label>
        </kendo-formfield>
      </form>
    </div>

    <kendo-dialog-actions>
      <kendo-button (click)="closeDialog()">Cancel</kendo-button>
      <kendo-button (click)="save()" themeColor="primary"
        >Add Company</kendo-button
      >
    </kendo-dialog-actions>
  </kendo-dialog>
}
