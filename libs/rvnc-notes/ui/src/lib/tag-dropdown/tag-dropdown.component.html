<kendo-dropdowntree
  #dropDownTree
  (clickOutside)="dropDownTree.toggle(false)"
  (close)="$event.preventDefault()"
  (filterChange)="filterValue.set($event)"
  [expandOnFilter]="filterExpandSettings"
  [filterable]="true"
  [kendoDropDownTreeFlatBinding]="filteredData()"
  [loading]="loading"
  fillMode="outline"
  kendoDropDownTreeExpandable
  parentIdField="companyId"
  placeholder="Select tag..."
  textField="name"
  valueField="id"
>
  <ng-template kendoDropDownTreeHeaderTemplate>
    <div class="flex flex-col gap-3 px-3 pb-1 pt-2">
      <kendo-buttongroup
        class="w-full justify-between gap-1"
        selection="single"
      >
        <button
          (selectedChange)="selectedChange(button.id)"
          *ngFor="let button of selectedButtons()"
          [selected]="button.selected!"
          [toggleable]="true"
          kendoButton
          size="small"
        >
          <span>
            {{ button.text }}
          </span>
        </button>
      </kendo-buttongroup>
      <div
        *ngIf="filterValue().trim()"
        class="selected-item-shadow flex gap-2 px-1.5 py-0.5"
      >
        <p class="grow">{{ filterValue() }} (Add new tag)</p>
        <kendo-button
          (click)="onOpenTagDialog(); dropDownTree.toggle(false)"
          class="!p-0"
          fillMode="flat"
          iconClass="fa-solid fa-plus"
        ></kendo-button>
      </div>
      <p class="font-bold">{{ type() | titlecase }}</p>
    </div>
  </ng-template>

  <ng-template kendoDropDownTreeNodeTemplate let-dataItem let-index="index">
    <div
      (click)="itemClicked(dataItem); $event.stopPropagation()"
      class="align-center flex px-2 py-1"
    >
      <span> {{ dataItem.label || dataItem.name }}</span>
      <!--      <i class="fa-regular fa-tag ml-20"></i>-->
    </div>
  </ng-template>
</kendo-dropdowntree>
